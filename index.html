<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Malcolm's Recipes</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Sans:ital,wght@0,400;0,500;0,600;1,400&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --ink: #1a1714;
    --paper: #faf8f5;
    --warm: #e8e2d9;
    --muted: #7a7168;
    --bg: #eee9e0;
    --radius: 8px;
  }
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: 'DM Sans', system-ui, sans-serif;
    background: var(--bg);
    color: var(--ink);
    min-height: 100vh;
    -webkit-font-smoothing: antialiased;
  }

  /* ── Header ── */
  .site-header {
    background: var(--ink);
    color: var(--paper);
    padding: 3rem 2rem 2.5rem;
    text-align: center;
  }
  .site-header h1 {
    font-family: 'DM Serif Display', serif;
    font-size: clamp(2rem, 5vw, 3rem);
    font-weight: 400;
    letter-spacing: -0.02em;
    margin-bottom: 0.5rem;
  }
  .site-header p {
    color: rgba(250,248,245,0.5);
    font-size: 0.9rem;
    letter-spacing: 0.04em;
    text-transform: uppercase;
  }

  /* ── Main layout ── */
  .main {
    max-width: 860px;
    margin: 0 auto;
    padding: 2.5rem 1.5rem 4rem;
  }

  /* ── Status bar ── */
  .status {
    font-size: 0.82rem;
    color: var(--muted);
    font-family: 'JetBrains Mono', monospace;
    margin-bottom: 1.8rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  .status-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: var(--muted);
    flex-shrink: 0;
  }
  .status-dot.loading { background: #e8a83a; animation: pulse 1s infinite; }
  .status-dot.ready   { background: #5a8a3a; }
  .status-dot.error   { background: #c04a2a; }
  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.3} }

  /* ── Recipe grid ── */
  .recipe-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
    gap: 1rem;
  }

  /* ── Recipe card ── */
  .recipe-card {
    background: var(--paper);
    border-radius: var(--radius);
    box-shadow: 0 1px 3px rgba(26,23,20,0.07), 0 4px 16px rgba(26,23,20,0.05);
    overflow: hidden;
    text-decoration: none;
    color: inherit;
    display: flex;
    flex-direction: column;
    transition: transform 0.15s ease, box-shadow 0.15s ease;
  }
  .recipe-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 2px 6px rgba(26,23,20,0.10), 0 8px 24px rgba(26,23,20,0.09);
  }
  .card-accent {
    height: 4px;
    background: var(--card-color, #8b6914);
  }
  .card-body {
    padding: 1.2rem 1.3rem 1.4rem;
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }
  .card-title {
    font-family: 'DM Serif Display', serif;
    font-size: 1.05rem;
    font-weight: 400;
    line-height: 1.3;
    color: var(--ink);
  }
  .card-slug {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.72rem;
    color: var(--muted);
    margin-top: auto;
    padding-top: 0.6rem;
  }

  /* ── Skeleton loader ── */
  .skeleton {
    background: var(--paper);
    border-radius: var(--radius);
    overflow: hidden;
    box-shadow: 0 1px 3px rgba(26,23,20,0.07);
  }
  .skeleton-accent {
    height: 4px;
    background: var(--warm);
  }
  .skeleton-body { padding: 1.2rem 1.3rem 1.4rem; display: flex; flex-direction: column; gap: 0.6rem; }
  .skeleton-line {
    height: 14px;
    border-radius: 4px;
    background: linear-gradient(90deg, var(--warm) 25%, #f5f2ee 50%, var(--warm) 75%);
    background-size: 200% 100%;
    animation: shimmer 1.4s infinite;
  }
  .skeleton-line.wide  { width: 85%; }
  .skeleton-line.short { width: 45%; height: 10px; margin-top: 0.8rem; }
  @keyframes shimmer { 0%{background-position:200% 0} 100%{background-position:-200% 0} }

  /* ── Empty / error states ── */
  .state-msg {
    grid-column: 1 / -1;
    text-align: center;
    padding: 3rem 1rem;
    color: var(--muted);
    font-size: 0.92rem;
    line-height: 1.6;
  }
  .state-msg strong { display: block; color: var(--ink); font-size: 1rem; margin-bottom: 0.4rem; }

  @media (max-width: 480px) {
    .recipe-grid { grid-template-columns: 1fr; }
    .site-header { padding: 2rem 1.5rem; }
  }
</style>
</head>
<body>

<header class="site-header">
  <h1>Recipes</h1>
  <p>malcolmspittler-ops · GitHub Pages</p>
</header>

<main class="main">
  <div class="status" id="status">
    <span class="status-dot loading" id="status-dot"></span>
    <span id="status-text">Loading recipes…</span>
  </div>

  <div class="recipe-grid" id="grid">
    <!-- skeleton placeholders -->
    <div class="skeleton"><div class="skeleton-accent"></div><div class="skeleton-body"><div class="skeleton-line wide"></div><div class="skeleton-line short"></div></div></div>
    <div class="skeleton"><div class="skeleton-accent"></div><div class="skeleton-body"><div class="skeleton-line wide"></div><div class="skeleton-line short"></div></div></div>
    <div class="skeleton"><div class="skeleton-accent"></div><div class="skeleton-body"><div class="skeleton-line wide"></div><div class="skeleton-line short"></div></div></div>
  </div>
</main>

<script>
  // ── Config ──────────────────────────────────────────────────────────────────
  const GITHUB_USER = 'malcolmspittler-ops';
  const GITHUB_REPO = 'Recipes';
  const API_URL = `https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/`;

  // Assign a consistent accent color per recipe based on filename hash
  const PALETTE = [
    '#8b6914', // gold
    '#8b3a14', // burnt orange
    '#5a6e3a', // olive
    '#2a6e8b', // slate blue
    '#6e3a8b', // plum
    '#3a6e5a', // teal
    '#8b4a2a', // terracotta
    '#4a5a8b', // indigo
  ];
  function colorFor(str) {
    let h = 0;
    for (let i = 0; i < str.length; i++) h = (h * 31 + str.charCodeAt(i)) >>> 0;
    return PALETTE[h % PALETTE.length];
  }

  // Prettify a filename slug into a readable title
  function slugToTitle(slug) {
    return slug
      .replace(/\.html$/i, '')
      .replace(/[-_]/g, ' ')
      .replace(/\b\w/g, c => c.toUpperCase());
  }

  // Try to extract <title> text from fetched HTML
  async function fetchTitle(url, fallback) {
    try {
      const r = await fetch(url, { cache: 'no-store' });
      if (!r.ok) return fallback;
      const html = await r.text();
      const m = html.match(/<title[^>]*>([^<]+)<\/title>/i);
      return m ? m[1].trim() : fallback;
    } catch {
      return fallback;
    }
  }

  // ── Render ───────────────────────────────────────────────────────────────────
  function setStatus(state, text) {
    document.getElementById('status-dot').className = `status-dot ${state}`;
    document.getElementById('status-text').textContent = text;
  }

  function renderCards(recipes) {
    const grid = document.getElementById('grid');
    if (recipes.length === 0) {
      grid.innerHTML = `<div class="state-msg"><strong>No recipes yet.</strong>Drop an HTML file into your Recipes folder and push.</div>`;
      return;
    }
    grid.innerHTML = recipes.map(({ title, slug, url, color }) => `
      <a class="recipe-card" href="${url}" style="--card-color:${color}">
        <div class="card-accent"></div>
        <div class="card-body">
          <div class="card-title">${title}</div>
          <div class="card-slug">${slug}</div>
        </div>
      </a>
    `).join('');
  }

  // ── Main ─────────────────────────────────────────────────────────────────────
  async function loadRecipes() {
    let files;
    try {
      const res = await fetch(API_URL);
      if (!res.ok) throw new Error(`GitHub API ${res.status}`);
      files = await res.json();
    } catch (err) {
      setStatus('error', `Could not reach GitHub API — ${err.message}`);
      document.getElementById('grid').innerHTML = `<div class="state-msg"><strong>Failed to load recipe list.</strong>Check your network or try again shortly.</div>`;
      return;
    }

    // Filter to HTML files only, exclude index.html itself
    const htmlFiles = files.filter(f =>
      f.type === 'file' &&
      f.name.toLowerCase().endsWith('.html') &&
      f.name.toLowerCase() !== 'index.html'
    );

    if (htmlFiles.length === 0) {
      setStatus('ready', '0 recipes found');
      renderCards([]);
      return;
    }

    setStatus('loading', `Found ${htmlFiles.length} recipe${htmlFiles.length > 1 ? 's' : ''} — loading titles…`);

    // Fetch real <title> from each file in parallel
    const baseUrl = `https://${GITHUB_USER}.github.io/${GITHUB_REPO}/`;
    const recipes = await Promise.all(
      htmlFiles.map(async f => {
        const url = baseUrl + f.name;
        const fallback = slugToTitle(f.name);
        const title = await fetchTitle(url, fallback);
        return { title, slug: f.name, url, color: colorFor(f.name) };
      })
    );

    // Sort alphabetically by title
    recipes.sort((a, b) => a.title.localeCompare(b.title));

    renderCards(recipes);
    setStatus('ready', `${recipes.length} recipe${recipes.length > 1 ? 's' : ''}`);
  }

  loadRecipes();
</script>
</body>
</html>
